
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://kudzuyu.github.io/SUMO-wiki-ja/Simulation/Railways/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Railways - SUMO wiki ja</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansjp.css">
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:600,800">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#train-simulation" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../.." title="SUMO wiki ja" class="md-header__button md-logo" aria-label="SUMO wiki ja" data-md-component="logo">
      
  <img src="../../images/sumo-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SUMO wiki ja
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Railways
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="タブ" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  ドキュメント

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../Downloads/" class="md-tabs__link">
        
  
  
    
  
  ダウンロード

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../Publications/" class="md-tabs__link">
        
  
  
    
  
  出版物

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SUMO wiki ja" class="md-nav__button md-logo" aria-label="SUMO wiki ja" data-md-component="logo">
      
  <img src="../../images/sumo-logo.png" alt="logo">

    </a>
    SUMO wiki ja
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ドキュメント
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Downloads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ダウンロード
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Publications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    出版物
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="train-simulation">Train Simulation<a class="headerlink" href="#train-simulation" title="Permanent link">&para;</a></h1>
<p>This page describes simulations of trains in SUMO. To build an
intermodal simulation scenario with trains, additional steps have to be
taken in comparison to a plain vehicular simulation.</p>
<h1 id="building-a-network-for-train-simulation">Building a network for train simulation<a class="headerlink" href="#building-a-network-for-train-simulation" title="Permanent link">&para;</a></h1>
<h2 id="railways">Railways<a class="headerlink" href="#railways" title="Permanent link">&para;</a></h2>
<p>Railways can be imported from
<a href="../../Networks/Import/OpenStreetMap/">OSM</a>. They can also be
explicitly specified using the existing <em>vClasses</em>.</p>
<h3 id="parallel-tracks">Parallel Tracks<a class="headerlink" href="#parallel-tracks" title="Permanent link">&para;</a></h3>
<p>If a railway has parallel tracks, these must be modelled as distinct edge
elements instead of a single edge with multiple "lanes".</p>
<h3 id="osm">OSM<a class="headerlink" href="#osm" title="Permanent link">&para;</a></h3>
<h4 id="types">Types<a class="headerlink" href="#types" title="Permanent link">&para;</a></h4>
<p>When importing from OSM the following railway types are distinguished by
default (via <a href="https://github.com/eclipse/sumo/blob/master/data/typemap/osmNetconvert.typ.xml"><strong><em>&lt;SUMO_HOME&gt;</em></strong>/data/typemap/osmNetconvert.typ.xml</a>):</p>
<ul>
<li>tram</li>
<li>subway</li>
<li>light_rail</li>
<li>rail</li>
<li><a href="https://en.wikipedia.org/wiki/High-speed_rail">highspeed</a></li>
</ul>
<h4 id="electrification">Electrification<a class="headerlink" href="#electrification" title="Permanent link">&para;</a></h4>
<p>Whenever a railway is electrified, the vClasses <em>rail</em>, <em>rail_electric</em>
and <em>rail_fast</em> are permitted to drive there. Otherwise, only vClass
<em>rail</em> is allowed.</p>
<h4 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h4>
<p>By loading the additional typemap <a href="https://github.com/eclipse/sumo/blob/master/data/typemap/osmNetconvertRailUsage.typ.xml"><strong><em>&lt;SUMO_HOME&gt;</em></strong>/data/typemap/osmNetconvertRailUsage.typ.xml</a>, additional <a href="https://wiki.openstreetmap.org/wiki/Key:usage#With_railways">usage
information</a>
is exported for the edge types:</p>
<ul>
<li>main</li>
<li>branch</li>
<li>industrial</li>
<li>military</li>
<li>test</li>
<li>tourism</li>
</ul>
<p>This will lead to compound edge type ids such as
<em>railway.rail|usage.main</em>.</p>
<h4 id="track-numbers">Track numbers<a class="headerlink" href="#track-numbers" title="Permanent link">&para;</a></h4>
<p>Local track numbers (mostly in train stations) are exported as edge
parameter <em>track_ref</em>. These values are shown in the edge parameter
dialog and can also be used for coloring (<em>color by param, streetwise</em>).</p>
<h2 id="bidirectional-track-usage">Bidirectional track usage<a class="headerlink" href="#bidirectional-track-usage" title="Permanent link">&para;</a></h2>
<p>In reality all tracks can be used in either direction if the need arises
but many rails are used in only one direction most of the time. In SUMO,
bidirectional track usage must be enabled explicitly. This simplifies
routing as rails will only be used in their preferred direction most of
the time.</p>
<p>Bidirectional track usage is modeled by two edges that have their
geometries exactly reversed and using the attribute <code>spreadType="center"</code>. This will result
in lane geometries that are overlaid exactly. These edges are referred
to as <em>superposed</em> (alternatively as bidirectional rail edges). In the
.net.xml file these edges are marked with <code>bidi="&lt;REVERSE_EDGE_ID&gt;"</code> but this is a generated
attribute and not to be set by the user.</p>
<p>When Rail signals are placed at both ends of a bidirectional track they
will restrict its usage to one direction at a time.</p>
<h3 id="bidirectional-rails-in-sumo-gui">Bidirectional rails in <a href="../../sumo-gui/">sumo-gui</a><a class="headerlink" href="#bidirectional-rails-in-sumo-gui" title="Permanent link">&para;</a></h3>
<p>Visualization of bidirectional tracks has a distinct <a href="#network">style and dedicated settings</a>.</p>
<h3 id="working-with-bidirectional-tracks-in-netedit">Working with bidirectional tracks in <a href="../../Netedit/">netedit</a><a class="headerlink" href="#working-with-bidirectional-tracks-in-netedit" title="Permanent link">&para;</a></h3>
<ul>
<li>To show both edges that constitute a bidirectional track, activate
  edge visualization option <em>spread bidirectional railways/roads</em> (see <a href="../../sumo-gui/#edgelane_visualisation_settings">visualization settings</a>). Both edges will be
  drawn narrower and with a side-offset to make them both visible
  without overlap.</li>
<li>this is highly recommended when using connection mode to define connections among bidirectional tracks as it's otherwise hard to distinguish the affected edges</li>
<li>the pre-defined gui setting scheme 'rail' automatically activates the <em>spread ...</em> setting.</li>
<li>To find (and highlight) all bidirectional tracks, use <a href="../../Netedit/editModesCommon/#match_attribute">attribute
  selection</a> and search for
  attribute <em>bidi</em> with a value of <em>1</em></li>
<li>Create bidirectional tracks <a href="../../Netedit/neteditUsageExamples/#creating_bidirectional_railway_tracks">as explained
  here</a></li>
</ul>
<h3 id="routing-in-bidirectional-networks">Routing in bidirectional networks<a class="headerlink" href="#routing-in-bidirectional-networks" title="Permanent link">&para;</a></h3>
<p>When train tracks can be used in both directions, there is considerable freedom for trains when searching a path through the network. To reduce the number of conflicts (when two vehicles want to use the same track in opposite directions), the preferred direction for each track can be defined and factored into the routing decision.
There are two ways in which this may be accomplished. They work the same way during network preparation but differ in their effects during simulation.
Both methods are discussed below.</p>
<h3 id="using-priority-factor">Using priority-factor<a class="headerlink" href="#using-priority-factor" title="Permanent link">&para;</a></h3>
<p>This method is suitable for rail-only simulation because the option it uses affects all vehicles in the simulation and may have adverse effects on road traffic.
It's advantage lies in it's simplicity because it requires only a single option.</p>
<p>To express routing preferences, the edges in the preferred direction and on the
preferred side may be assigned a higher priority value (using edge attribute <code>priority</code>).
This value will be taken into account during routing when setting option <strong>--weights.priority-factor FLOAT</strong>  (applicable to
<a href="../../sumo/">sumo</a> and <a href="../../duarouter/">duarouter</a>).</p>
<p>At the default option value of 0. Edge priority is ignored when routing. When setting a positive value, the edges with the lowest priority receive a penalty factor to their estimated travel time of 1 + FLOAT (where FLOAT is the option argument) whereas the edges with the highest priority receive no penalty. Edges with medium priority will receive an intermediate penalty according to the following code:</p>
<pre><code> MinEdgePriority : minimum priority value of all edges
 MaxEdgePriority : maximum priority value of all edges
 EdgePriorityRange = MaxEdgePriority - MinEdgePriority

 relativeInversePrio = 1 - ((edgePriority - MinEdgePriority) / EdgePriorityRange)
 effort =  traveltime * (1 + relativeInversePrio * PriorityFactor)
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When either trains or road vehicles are routed only outside the simulation this method can also be used for combined simulations by (by routing trains and cars separately and only using the option for train routing).</p>
</div>
<h3 id="using-routingtype-and-preference-definitions">Using routingType and preference definitions<a class="headerlink" href="#using-routingtype-and-preference-definitions" title="Permanent link">&para;</a></h3>
<p>This method is suitable for multi-modal simulations where road and rail vehicles must be routed in the same simulation.
It also permits distinguishing fine-grained routing preferences (i.e. between regular rail service which adheres to the default directions and special service vehicles that may use any track in either direction).</p>
<p>To express routing preferences, each rail edge should have it's <code>routingType</code> set corresponding to it's status as being in the main direction or in reverse to the main direction. While <code>routingType</code> may be an arbitrary string value, the existing <a href="../../netconvert/">netconvert</a> tooling supports setting a <code>routingType</code> that takes on string values between '4' and '0' where '4' corresponds to the main direction and '0' to the reverse of the main direction (with values in between denoting different levels of certainty about directionality).</p>
<p>The effect that each <code>routingType</code> takes during routing is expressed by loading <code>&lt;preference&gt;</code> elements from an additional file:
During routing, the estimated travelTime of an edge with the given <code>routingType</code> is divided by the given priority value for an applicable <code>vClass</code> <a href="../Routing/#routing_by_travel_time_and_routingtype">(or <code>vType</code>)</a>.</p>
<p>The following example has the same effect as setting option <strong>weights.priority-factor 1</strong> (but only applies to vClass <em>rail</em>).</p>
<pre><code class="language-xml">&lt;additional &gt;
    &lt;preference routingType=&quot;4&quot; vClasses=&quot;rail&quot; priority=&quot;1&quot;/&gt;
    &lt;preference routingType=&quot;3&quot; vClasses=&quot;rail&quot; priority=&quot;0.8&quot;/&gt;
    &lt;preference routingType=&quot;2&quot; vClasses=&quot;rail&quot; priority=&quot;0.67&quot;/&gt;
    &lt;preference routingType=&quot;1&quot; vClasses=&quot;rail&quot; priority=&quot;0.57&quot;/&gt;
    &lt;preference routingType=&quot;0&quot; vClasses=&quot;rail&quot; priority=&quot;0.5&quot;/&gt;
&lt;/additional&gt;
</code></pre>
<p>The following example has the same effect as setting option <strong>weights.priority-factor 3</strong> (but only applies to vTypes <em>train1</em> and <em>train2</em>).</p>
<pre><code class="language-xml">&lt;additional &gt;
    &lt;preference routingType=&quot;4&quot; vTypes=&quot;train1 train2&quot; priority=&quot;1&quot;/&gt;
    &lt;preference routingType=&quot;3&quot; vClasses=&quot;rail&quot; priority=&quot;0.57&quot;/&gt;
    &lt;preference routingType=&quot;2&quot; vClasses=&quot;rail&quot; priority=&quot;0.40&quot;/&gt;
    &lt;preference routingType=&quot;1&quot; vClasses=&quot;rail&quot; priority=&quot;0.31&quot;/&gt;
    &lt;preference routingType=&quot;0&quot; vClasses=&quot;rail&quot; priority=&quot;0.25&quot;/&gt;
&lt;/additional&gt;
</code></pre>
<h3 id="setting-edge-priority-and-routingtype">Setting edge priority and routingType<a class="headerlink" href="#setting-edge-priority-and-routingtype" title="Permanent link">&para;</a></h3>
<p>The <code>priority</code> and corresponding <code>routingType</code> values can either be assigned by the user or computed heuristically by <a href="../../netconvert/">netconvert</a> as explained below.
Note, that in both heuristics each railway edge will have their <code>priority</code> attribute set and it's <code>routingType</code> will be set equal the numerical priority value (converted to a string).</p>
<h4 id="priority-from-partially-restricted-directionality">Priority from partially restricted directionality<a class="headerlink" href="#priority-from-partially-restricted-directionality" title="Permanent link">&para;</a></h4>
<p>If some of the tracks in the network are uni-directional these can be used to define the main direction and this property can be extrapolated based on geometry (straightness) and topology (switches) onto the rest of the network This is done by setting the option <strong>--railway.topology.direction-priority</strong>. The assigned priority values are:</p>
<ul>
<li>4: unidirectional track</li>
<li>3: main direction of bidirectional track</li>
<li>2: undetermined main direction (straight continuation from different directions of unidirectional track)</li>
<li>1: undetermined main direction (no continuation from unidirectional track)</li>
<li>0: reverse of main direction of bidirectional track</li>
</ul>
<h4 id="priority-from-partially-defined-values">Priority from partially defined values<a class="headerlink" href="#priority-from-partially-defined-values" title="Permanent link">&para;</a></h4>
<p>If some of the tracks in the network have priority values defined (by convention with the values 0 and 4) these can be used to define the main direction and this property can be extrapolated based on geometry (straightness) and topology (switches) onto the rest of the network This is done by setting the option <strong>--railway.topology.extend-priority</strong>. The assigned priority for the other network edges also range from 1 to 3 just as above.</p>
<h3 id="importing-bidirectional-tracks-from-osm">Importing bidirectional tracks from OSM<a class="headerlink" href="#importing-bidirectional-tracks-from-osm" title="Permanent link">&para;</a></h3>
<p>When importing networks from
<a href="../../Networks/Import/OpenStreetMap/">OSM</a>, rails tagged with <code>railway:preferred_direction:both</code> are
automatically imported as superposed edges.</p>
<h3 id="handling-problems-in-bidirectional-railway-networks">Handling Problems in bidirectional railway networks<a class="headerlink" href="#handling-problems-in-bidirectional-railway-networks" title="Permanent link">&para;</a></h3>
<p>Commonly, rail networks import from OSM are incomplete in regard to
bidirectional track usage. One example would be terminal tracks which a
train can only leave by reversing direction. <a href="../../netconvert/">netconvert</a> provides several options to deal with this problem:</p>
<ul>
<li><strong>--railway.topology.output</strong> <a href="/Basics/Notation/#データタイプ"><em>&lt;FILE&gt;</em></a>: Identify problematic tracks (i.e. for manual correction).</li>
<li><strong>--railway.topology.repair</strong> : Automatically fixes problems by analyzing rail network topology and adding bidirectional tracks</li>
<li><strong>--railway.topology.repair.minimal</strong> : Apply automated fixes but only those which are needed for the operation loaded public transport lines</li>
<li><strong>--railway.topology.repair.connect-straight</strong> : Allow bidirectional rail use wherever rails with opposite directions meet at a straight angle</li>
<li><strong>--railway.topology.repair.stop-turn</strong> : Add turn-around connections at all loaded stops (to enable direction reversal).</li>
<li><strong>--railway.topology.all-bidi</strong> : make all tracks usable in both directions.</li>
<li><strong>--railway.topology.all-bidi.input-file</strong> : Load edge ids from text file and make those tracks usable in both directions. (one edge id per line, optionally prefixed with 'edge:' as in a <a href="../../Netedit/editModesCommon/#selection_operations">selection file created with netedit</a>).</li>
</ul>
<h2 id="rail-signals">Rail Signals<a class="headerlink" href="#rail-signals" title="Permanent link">&para;</a></h2>
<h3 id="definition">Definition<a class="headerlink" href="#definition" title="Permanent link">&para;</a></h3>
<p>The <a href="../../Networks/PlainXML/#node_descriptions">node type</a>
<code>rail_signal</code> may be used to define signals which implement <a href="https://en.wikipedia.org/wiki/Automatic_block_signaling">Automatic Block
Signaling</a>.</p>
<p>When working with bidirectional tracks, rail signals will affect both directions of travel by default. This can be <a href="../../Netedit/neteditUsageExamples/#define_rail_signals_that_only_affect_one_track_direction">changed in netedit</a> or by patching with a <a href="../../Networks/PlainXML/#explicitly_setting_which_edge_lane_is_connected_to_which">connection file with attribute <code>uncontrolled</code></a>.</p>
<h3 id="import">Import<a class="headerlink" href="#import" title="Permanent link">&para;</a></h3>
<p>When importing rail networks from OSM, the rules for <a href="../../Networks/Import/OpenStreetMap/#railway_signals">what counts as a rail signal can be customized</a> to adapt to the local level of database detail.</p>
<p>By setting the <a href="../../netconvert/">netconvert</a>-option <strong>--railway.signals.discard</strong> all signals can be removed from a network.</p>
<h3 id="heuristic-generation">Heuristic generation<a class="headerlink" href="#heuristic-generation" title="Permanent link">&para;</a></h3>
<p>By setting the <a href="../../netconvert/">netconvert</a>-option <strong>--railway.signal.guess-by-stops</strong>, additional signal based on loaded public transport stops.
Stops are either loaded from the input (i.e. OSM) or with option <strong>--ptstop-files</strong>.</p>
<p>For each public transport stop, at most two signals will be added:</p>
<ul>
<li>a signal at the end of the stop edge (unless the node happens to be a switch)</li>
<li>a signal at the start of the stop edge or the next upstream edge that is at least 200m upstream of the stop edge end (unless the node happens to be a switch)</li>
</ul>
<p>The minimum distance of 200m between the two signals can be customized with option <strong>--osm.stop-outout.length.train</strong>.</p>
<h2 id="rail-crossings">Rail Crossings<a class="headerlink" href="#rail-crossings" title="Permanent link">&para;</a></h2>
<p>The <a href="../../Networks/PlainXML/#node_descriptions">node type</a>
<code>rail_crossing</code> may be used to define railway crossings. At these nodes trains will
always have the right of way and road vehicles get a red light until
there is a safe gap between approaching trains.</p>
<p>When importing networks from
<a href="../../Networks/Import/OpenStreetMap/">OpenStreetMap</a>, rail
crossings will be imported automatically. For other input data sources
the crossings may have to be specified <a href="../../Tutorials/ScenarioGuide/#modifying_an_imported_network_via_plainxml">via additional xml
files</a>
or set via <a href="../../Netedit/">netedit</a> after importing.</p>
<h3 id="rail-crossing-parameters">Rail Crossing Parameters<a class="headerlink" href="#rail-crossing-parameters" title="Permanent link">&para;</a></h3>
<p>The following parameters may be defined in an additional file to configure timing and behavior of a rail crossing (example below).
Time values are in seconds.</p>
<ul>
<li>time-gap : time headway of approaching train that triggers closing the crossing (default 15)</li>
<li>space-gap : space headway of approaching train that triggers closing the crossing (default -1, which disables this check)</li>
<li>min-green-time : minimum green time for opening the crossing when another train is approaching (default 5)</li>
<li>opening-delay : time after train has passed the crossing before the opening sequence starts (default 3)</li>
<li>opening-time : time for opening the crossing (indicated by red-yellow state 'u') (default 3)</li>
<li>yellow-time : time for closing the crossing (default 3)</li>
</ul>
<p>When setting parameters, <code>id</code> indicates the id of the rail-crossing junction and <code>programID</code> is always '0'.</p>
<pre><code class="language-xml">&lt;additional&gt;
    &lt;tlLogic id=&quot;C&quot; programID=&quot;0&quot;&gt;
        &lt;param key=&quot;time-gap&quot; value=&quot;15.0&quot;/&gt;
        &lt;param key=&quot;space-gap&quot; value=&quot;-1.0&quot;/&gt;
        &lt;param key=&quot;min-green-time&quot; value=&quot;5.0&quot;/&gt;
        &lt;param key=&quot;opening-delay&quot; value=&quot;3.0&quot;/&gt;
        &lt;param key=&quot;opening-time&quot; value=&quot;3.0&quot;/&gt;
        &lt;param key=&quot;yellow-time&quot; value=&quot;5.0&quot;/&gt;
    &lt;/tlLogic&gt;
&lt;/additional&gt;
</code></pre>
<h2 id="kilometrage-mileage-chainage">Kilometrage (Mileage, Chainage)<a class="headerlink" href="#kilometrage-mileage-chainage" title="Permanent link">&para;</a></h2>
<p>Edges support the attribute <em>distance</em> to denote the distance at the
start of the edge relative to some point of reference for a <a href="https://en.wikipedia.org/wiki/Linear_referencing">linear
referencing scheme</a>.
When the distance metric decreases along the forward direction of the edge, this is indicated by using a negative sign for the distance value.</p>
<p>The distance value along an edge is computed as:</p>
<pre><code>  |edgeDistance + vehiclePos|
</code></pre>
<p>Edge distance is imported from OSM and can also be be set along a route in <a href="../../Netedit/elementsDemand/#route">netedit</a></p>
<p>The distances value can be written in <a href="../Output/FCDOutput/#further_options">fcd-output</a> using option <strong>--fcd-output.distance</strong>. It may then be used for plotting by <a href="../../Tools/Visualization/#plot_trajectoriespy">plot_trajectories.py</a> using the code <code>k</code> (i.e. -t kt). The distances can also be visualized in sumo-gui (color edges by distance).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Negative distance values are not currently supported (pending introduction of another attribute)</p>
</div>
<h1 id="modelling-trains">Modelling Trains<a class="headerlink" href="#modelling-trains" title="Permanent link">&para;</a></h1>
<p>There is a dedicated carFollowMode for trains which can be activated by
setting <code>carFollowModel="Rail" trainType="&lt;TYPE&gt;"</code> in the <code>&lt;vType&gt;</code> definition. Allowed values for trainType are</p>
<ul>
<li>Freight</li>
<li>ICE1</li>
<li>ICE3</li>
<li>RB425</li>
<li>RB628</li>
<li>REDosto7</li>
<li>NGT400</li>
<li>NGT400_16</li>
<li>MireoPlusB</li>
<li>MireoPlusH</li>
<li>custom</li>
</ul>
<p>These types model traction and rolling resistance for particular trains. To represent the behavior of arbitrary trains, the "custom" trainType may be used (see below).
Alternatively, any other car following model may be used and configured with appropriate acceleration / deceleration parameters.</p>
<h1 id="custom-dynamics-model-with-tabular-data">Custom dynamics model with tabular data<a class="headerlink" href="#custom-dynamics-model-with-tabular-data" title="Permanent link">&para;</a></h1>
<p>The vType attributes <code>speedTable</code>, <code>tractionTable</code> and <code>resistanceTable</code> can be used to specify a custom interpolation table for traction and resistance.
Each attribute is interpreted as a table column where the rows defines the traction and resistance for the corresponding speed.
The speeds must be given in m/s whereas the traction and resistance forces are in kN. Intermediate values are obtained by linear interpolation.</p>
<p>Example:</p>
<pre><code class="language-xml">    &lt;vType id=&quot;0&quot; vClass=&quot;rail&quot; carFollowModel=&quot;Rail&quot; trainType=&quot;custom&quot;
           speedTable=&quot;0 2.78 5.56 8.33 11.11 13.89 16.67 19.44 22.22 25 27.78 30.56 33.33&quot;
           tractionTable=&quot;300 300 263 179 135 108 90 77 67.5 60 54 49 45&quot;
           resistanceTable=&quot;2 4 8.5 14 22 31 41.5 54 68 83.5 111 120 140&quot;/&gt;
</code></pre>
<h1 id="custom-dynamics-model-with-parameterized-curves">Custom dynamics model with parameterized curves<a class="headerlink" href="#custom-dynamics-model-with-parameterized-curves" title="Permanent link">&para;</a></h1>
<p>The vType attributes <code>maxPower</code> and <code>maxTraction</code> can be used to specify the traction curve for a given speed (in m/s) according to the formula:</p>
<p><code>traction_kN = min(maxPower / speed, maxTraction</code></p>
<p>The vType attributes <code>resCoef_quadratic</code>, <code>resCoef_linear</code> and <code>resCoef_constant</code> can be usd to specify the resistance curve for a given speed (in m/s) according to the formula:</p>
<p><code>resistance_kN =  resCoef_quadratic * speed * speed + resCoef_linear * speed + resCoef_constant</code></p>
<p>Example:</p>
<pre><code class="language-xml">   &lt;vType id=&quot;0&quot; vClass=&quot;rail&quot; carFollowModel=&quot;Rail&quot; trainType=&quot;custom&quot; maxPower=&quot;2350&quot; maxTraction=&quot;150&quot;
        resCoef_quadratic=&quot;0.00028&quot; resCoef_linear=&quot;0.00003&quot; resCoef_constant=&quot;1.670&quot;/&gt;
</code></pre>
<p>The attributes</p>
<h1 id="train-schedules">Train Schedules<a class="headerlink" href="#train-schedules" title="Permanent link">&para;</a></h1>
<p>Train schedules are defined in the same way as for any other type of <a href="../Public_Transport/#public_transport_schedules">public transport</a>.</p>
<p><img src="../images/schedule_until.png" width="500px"/></p>
<p>Generated by <a href="../../Tools/Visualization/#public_transport_schedule">plotXMLAttributes.py</a>.</p>
<h1 id="train-interaction">Train Interaction<a class="headerlink" href="#train-interaction" title="Permanent link">&para;</a></h1>
<p>When simulation trains on a network with railway signals, trains will
only enter a block (a section of edges between signals) if it is free of
other trains. When there are no rail signals or multiple trains have
been inserted in the same block, they will automatically keep a safe
distance according to their car following model. When using <code>carFollowModel="Rail"</code>, trains
will always keep enough distance to the leading train to come to a safe
stop even if the lead train was to stop instantly.</p>
<h1 id="reversing-direction">Reversing Direction<a class="headerlink" href="#reversing-direction" title="Permanent link">&para;</a></h1>
<p>Trains will reverse direction if all of the following conditions are
met:</p>
<ul>
<li>The head of the train is on a normal edge (not on an intersection /
  railway switch)</li>
<li>The whole length of the train is located on rail-edges that allow
  bidirectional use.</li>
<li>The speed of the train is below 0.1m/s.</li>
<li>The train does not have any further stops on the current edge</li>
<li>The succeeding edges in the train's route are the reverse-direction
  edges of those it is currently on</li>
<li>There is a "turn-around" connection from the current train edge to
  the reverse direction edge</li>
</ul>
<p>!!! note
      When importing public transport stops with option <strong>--ptstop-output</strong>, all bidirectional edges with a public transport stop will have the necessary turn-around connection and thus be eligible for reversing.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Undesirable train reversals may occur due to invalid stop assignment (i.e. assigning the reverse stop). The tool <a href="../../Tools/Railways/#checkreversalspy">checkReversals.py</a> can be used to search for unexpected reversals.</p>
</div>
<h1 id="portion-working">Portion working<a class="headerlink" href="#portion-working" title="Permanent link">&para;</a></h1>
<p>Trains can be split and joined (divided and coupled) at stops. If a person or container travels in a train that is split or joined and wants to continue traveling in the new part, it requires a distinct <code>&lt;ride&gt;</code> or <code>&lt;transport&gt;</code> element in it's plan. No delay for boarding or loading will occur in the simulation for this.</p>
<h2 id="splitting-a-train">Splitting a train<a class="headerlink" href="#splitting-a-train" title="Permanent link">&para;</a></h2>
<p>To split a train, the following input definition can be used. The rear half of the train is defined as a new vehicle which depart value <strong>split</strong>. The train train that is being split must define the 'split' attribute in its stop definition referencing the id of the rear half.</p>
<pre><code class="language-xml">   &lt;vType id=&quot;train&quot; vClass=&quot;rail&quot;/&gt;
    &lt;vType id=&quot;splitTrain&quot; vClass=&quot;rail&quot; length=&quot;50&quot;/&gt;
    &lt;trip id=&quot;t0&quot; type=&quot;train&quot; depart=&quot;0.00&quot; from=&quot;a&quot; to=&quot;c&quot;&gt;
        &lt;stop busStop=&quot;B&quot; duration=&quot;60.00&quot; split=&quot;t1&quot;/&gt;
    &lt;/trip&gt;
    &lt;trip id=&quot;t1&quot; type=&quot;splitTrain&quot; depart=&quot;split&quot; from=&quot;b&quot; to=&quot;e&quot;&gt;
        &lt;stop busStop=&quot;B&quot; duration=&quot;60.00&quot;/&gt;
    &lt;/trip&gt;
</code></pre>
<p>When defined this way, The rear part of the train will be created as a new simulation vehicle once the first part has reached the stop. After stopping, The front half of the train will continue with reduced length.
If the vehicle that is split if (with <code>depart="split"</code>) uses attribute <code>departPos="splitFront"</code> it will instead be inserted at front and the part that keeps its id will be positioned in the rear.</p>
<h2 id="joining-two-trains">Joining two trains<a class="headerlink" href="#joining-two-trains" title="Permanent link">&para;</a></h2>
<p>To join two trains, they have to stop at in close proximity (i.e. at the same <code>&lt;busStop&gt;</code> or <code>&lt;trainStop&gt;</code>) and then one of them is removed (referred to as the <strong>joining train</strong>) and the other made longer (referred to as the <strong>continuing train</strong>.</p>
<p>The continuing train requires a stop with attribute <code>triggered="join"</code>. By default this train will only continue its route after another train has joined with it and wait indefinitely for this condition.
However, by setting stop attribute <a href="../../Definition_of_Vehicles%2C_Vehicle_Types%2C_and_Routes/#stops_and_waypoints">extension</a>, waiting for the trigger condition can be aborted (as for any other condition).
The joining train requires a stop with attribute <code>join="VEH_ID"</code> where <code>VEH_ID</code> denotes the id of the continuing train.</p>
<p>The joining operating consists of having the joining train arrive and disappear from the simulation and the continuing train to be made longer according to the length of the joining train.
The following conditions must be met for the joining operation to take place:</p>
<ul>
<li>the continuing train has fulfilled its stopping duration (defined by attributes <code>duration</code> and <code>until</code>)</li>
<li>the joining train has fulfilled its stopping duration (defined by attributes <code>duration</code> and <code>until</code>)</li>
<li>the trains are in close proximity in either of the two ways:</li>
<li>the continuing train has its back is on the same lane as the joining train and the gap between them is less than the minGap of the joining train +1m</li>
<li>the joining train has its back on the same lane as the continuing train and the gap between the trains is less the minGap of the continuing train +1m</li>
</ul>
<p>The following is an example definition for joining two trains:</p>
<pre><code class="language-xml">    &lt;vType id=&quot;train&quot; vClass=&quot;rail&quot;/&gt;
    &lt;vType id=&quot;splitTrain&quot; vClass=&quot;rail&quot; length=&quot;50&quot;/&gt;
    &lt;trip id=&quot;t0&quot; type=&quot;splitTrain&quot; depart=&quot;0.00&quot; from=&quot;a&quot; to=&quot;c&quot;&gt;
        &lt;stop busStop=&quot;B&quot; duration=&quot;60.00&quot; triggered=&quot;join&quot;/&gt;
    &lt;/trip&gt;
    &lt;trip id=&quot;t1&quot; type=&quot;splitTrain&quot; depart=&quot;30&quot; from=&quot;d&quot; to=&quot;b&quot;&gt;
        &lt;stop busStop=&quot;B&quot; duration=&quot;5.00&quot; join=&quot;t0&quot;/&gt;
    &lt;/trip&gt;
</code></pre>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>if the joined train is in the front and covers multiple edges, then these must all match the route of the continuing train. Also the joining train should have the join-stop on the last edge of its route.</p>
</div>
<h1 id="rail-signal-behavior">Rail Signal Behavior<a class="headerlink" href="#rail-signal-behavior" title="Permanent link">&para;</a></h1>
<p>Rail signals perform the following safety functions automatically</p>
<ul>
<li>a) guard the track up to the next rail signal (signal block) so that only one train can enter this section at a time. This prevents rear-end collisions.</li>
<li>b) guard the track so that vehicles from different branches (flanks) cannot enter the same section. This prevents flanking collisions.</li>
<li>c) guard the track so that vehicles cannot enter bidirectional sections at the same time. This prevents head-on collisions.</li>
<li>d) prevent deadlocks on bidirectional sections</li>
</ul>
<p>Functionality <strong>a)</strong> corresponds to the "classic" safety behavior of rail signals (<a href="https://en.wikipedia.org/wiki/Punktf%C3%B6rmige_Zugbeeinflussung">PZB</a>). When option <strong>--railsignal-moving-block</strong> is set or individual signals are configured with parameter <em>moving-block</em> (see below), feature <strong>a)</strong> is disabled and trains will use their configured carFollowModel (i.e. 'Rail') for distance keeping. This is similar to the <a href="https://en.wikipedia.org/wiki/Linienzugbeeinflussung">LZB</a> safety system when used with extremely short virtual blocks.</p>
<p>To switch a  signal into moving-block-mode, the following additional file may be loaded:</p>
<pre><code class="language-xml">&lt;additional xmlns:xsi=&quot;https://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;https://sumo.dlr.de/xsd/additional_file.xsd&quot;&gt;
    &lt;tlLogic id=&quot;gneJ8&quot; programID=&quot;0&quot;&gt;
        &lt;param key=&quot;moving-block&quot; value=&quot;true&quot;/&gt;
    &lt;/tlLogic&gt;
&lt;/additional&gt;
</code></pre>
<p>Parameter <em>moving-block</em> may also be updated at runtime with <code>traci.trafficlight.setParameter</code>.</p>
<h2 id="schedule-constraints">Schedule Constraints<a class="headerlink" href="#schedule-constraints" title="Permanent link">&para;</a></h2>
<p>Additionally, rail signals can enforce train ordering to ensure that a <a href="../Public_Transport/#public_transport_schedules">scheduled order at stations</a> can be kept.
To make use of this, the following elements can be loaded from an additional file:</p>
<pre><code class="language-xml">   &lt;railSignalConstraints id=&quot;A&quot;&gt;
        &lt;predecessor tripId=&quot;t0&quot; tl=&quot;D&quot; foes=&quot;t1&quot; limit=&quot;2&quot;/&gt;
        &lt;predecessor tripId=&quot;t0&quot; tl=&quot;C&quot; foes=&quot;t2&quot;/&gt;
        &lt;insertionPredecessor tripId=&quot;t3&quot; tl=&quot;E&quot; foes=&quot;t4&quot;/&gt;
    &lt;/railSignalConstraints&gt;
</code></pre>
<h3 id="predecessor-constraint">predecessor constraint<a class="headerlink" href="#predecessor-constraint" title="Permanent link">&para;</a></h3>
<p>This constrain defines that a given vehicle id (or tripId) can only pass the current signal after some other vehicle ('foe') with the given id or tripId has passed signal 'tl'. The foe vehicle must have been the last vehicle to do so or it must have been one of the last 'limit' vehicles at the time of switching green.</p>
<h3 id="insertionpredecessor-constraint">insertionPredecessor constraint<a class="headerlink" href="#insertionpredecessor-constraint" title="Permanent link">&para;</a></h3>
<p>This constrain defines that a given vehicle id (or tripId) can only be inserted on the block leading up to the current signal after some other vehicle ('foe') with the given id or tripId has passed signal 'tl'. The foe vehicle must have been the last vehicle to do so or it must have been one of the last 'limit' vehicles at the time of switching green.</p>
<h3 id="constraint-attributes">Constraint Attributes<a class="headerlink" href="#constraint-attributes" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Attribute Name</th>
<th>Value Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>tripId</strong></td>
<td>id (string)</td>
<td>The 'tripId' param of a vehicle or the id of a vehicle to which this constraint applies</td>
</tr>
<tr>
<td><strong>tl</strong></td>
<td>id (string)</td>
<td>The id of a railSignal</td>
</tr>
<tr>
<td><strong>foes</strong></td>
<td>ids (string list)</td>
<td>The ids of one or more vehicles that must have passed <strong>tl</strong> before the parent rail signal permits <strong>tripID</strong> to pass</td>
</tr>
<tr>
<td>limit</td>
<td>int</td>
<td>The number of intermediate vehicles that may pass <strong>tl</strong> after the <strong>foes</strong> before the constraint is evaluated for <strong>tripId</strong>.  default: number of given <strong>foes</strong>. (setting a high number has now downside besides memory use but setting a low number may cause the constraint to block <strong>tripId</strong> indefinitely because the ids of the passed foes were <em>overwritten</em> by later trains)</td>
</tr>
<tr>
<td>active</td>
<td>bool</td>
<td>Whether this constraint is active (inactive constraints may still be retrieved via TraCI)</td>
</tr>
</tbody>
</table>
<h3 id="constraints-generation">constraints generation<a class="headerlink" href="#constraints-generation" title="Permanent link">&para;</a></h3>
<p>Constraints can be generated using the tool <a href="../../Tools/Railways/#generaterailsignalconstraintspy">generateRailSignalConstraints.py</a> by using a route file with <a href="../Public_Transport/#public_transport_schedules">stops that define a schedule</a>.</p>
<h1 id="deadlocks">Deadlocks<a class="headerlink" href="#deadlocks" title="Permanent link">&para;</a></h1>
<p>If the graph of relationships between trains that wait for another train ever forms a circle, then no train can ever advance and the simulation is in a state of deadlock.
The default behavior of rail signals is to anticipate most such problems and prevent a train from passing a signal if that movement would form a deadlock.
However, the default logic only handles the most common cases that involve two or three trains (and a few situations with four trains).</p>
<ul>
<li>Deadlocks may appear from an interplay of four or more trains.</li>
<li>The signal logic does not prevent deadlocks that involve loaded <a href="#schedule_constraints">signal constraints</a></li>
</ul>
<p>To deal with deadlock problems, the simulation provides multiple strategies explained in the following.</p>
<h2 id="deadlock-detection">Deadlock detection<a class="headerlink" href="#deadlock-detection" title="Permanent link">&para;</a></h2>
<p>By setting option <strong>--time-to-teleport.railsignal-deadlock TIME</strong> deadlocks are detected if one of the vehicles involved has been waiting for the given TIME.
If option <strong>--deadlock-output FILE</strong> is also set, then any detected deadlocks will be written to the given file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended to also set option <strong>--time-to-teleport -1</strong> to disabled teleporting based on waiting time since, trains may sometimes have to wait much longer than cars (which teleport after 300s by default).</p>
</div>
<h2 id="deadlock-resolution">Deadlock resolution<a class="headerlink" href="#deadlock-resolution" title="Permanent link">&para;</a></h2>
<p>In case a deadlock is detected, the vehicle that has been waiting in this deadlock for the longest time will be teleported to the next available network edge to break the deadlock.
If option <strong>--time-to-teleport.remove</strong> is set, the vehicle will instead be removed from the simulation.</p>
<p>By setting option <strong>--time-to-teleport.remove-constraint</strong>, a constraint involved in the deadlock will be deactivated to break the deadlock rather than teleporting or removing a vehicle. This option is highly recommended when working with constraints. But doesn't take effect otherwise.</p>
<p>If option <strong>--deadlock-output FILE</strong> is set, then the deactivated constraint will also be included in the recorded deadlock.</p>
<h2 id="deadlock-prevention">Deadlock prevention<a class="headerlink" href="#deadlock-prevention" title="Permanent link">&para;</a></h2>
<p>The prevent complex deadlocks that happened without the use of constraints, the recorded deadlocks from a previous simulation can be loaded as an additional file.
This will selectively add additional checks to the rail signal logic to prevent any deadlock constelation among the list of signals that were part of the recorded deadlocks.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The deadlock file must be loaded before any trains (which is only an issue if trains are loaded with option <strong>--additional-files</strong>).</p>
</div>
<h1 id="traci">TraCI<a class="headerlink" href="#traci" title="Permanent link">&para;</a></h1>
<p>Rail signals and rail crossings can be controlled with function <em>traci.trafficlight.setRedYellowGreenState</em>. They can also be switched off with <em>traci.trafficlight.setProgram(tlsID, "off")</em>. In either case, normal operations can be resumed by reactivating the default program "0": <em>traci.trafficlight.setProgram(tlsID, "0")</em>.</p>
<p>Trains can be controlled just like cars by using the <em>traci.vehicle</em> functions.
Furthermore the following functions are available for rail signals:</p>
<ul>
<li>traci.trafficlight.getBlockingVehicles(tlsID, linkIndex): Returns the list of vehicles that are blocking the subsequent block for the given tls-linkIndex from the perspective of the closest vehicle upstream of the signal</li>
<li>traci.trafficlight.getRivalVehicles(tlsID, linkIndex): Returns the list of vehicles that also wish to enter the subsequent block for the given tls-linkIndex (regardless of priority) from the perspective of the closest vehicle upstream of the signal</li>
<li>traci.trafficlight.getPriorityVehicles(tlsID, linkIndex): Returns the list of vehicles that also wish to enter the subsequent block for the given tls-linkIndex (only those with higher priority) from the perspective of the closest vehicle upstream of the signal</li>
</ul>
<h2 id="constraints">Constraints<a class="headerlink" href="#constraints" title="Permanent link">&para;</a></h2>
<p>Constraints can be queried and modified via TraCI:</p>
<ul>
<li><code>getConstraints(tlsID, tripId="")</code>: Returns the list of rail signal constraints for the given rail signal. If tripId is not "", only constraints with the given tripId are returned. Otherwise, all constraints are returned</li>
<li><code>getConstraintsByFoe(foeSignal, foeId="")</code>: Returns the list of rail signal constraints that have the given rail signal id as their foeSignal. If foeId is not "", only constraints with the given foeId are returned. Otherwise, all constraints are returned</li>
<li><code>addConstraint(tlsID, tripId, foeSignal, foeId, type=0, limit=0)</code>: add constraint with the given values (type 0 is a predecessor constraint, 1 insertion predecessor, 2 foe insertion, ...)</li>
<li><code>swapConstraints(tlsID, tripId, foeSignal, foeId)</code>:  Reverse the given constraint and return list of new constraints that were created (by swapping) to avoid deadlock.</li>
<li><code>removeConstraints(tlsID, tripId, foeSignal, foeId)</code>: remove constraints with the given values. Any combination of inputs may be set to "" to act as a wildcard filter """</li>
<li><code>updateConstraints(vehID, tripId="")</code>: remove any constraints related to the given tripId if the vehicle with the given vehID no longer passes the respective rail signals (i.e. after rerouting).</li>
<li>if tripId is the empty string, the current tripId param of the vehicle is used</li>
<li>if the tripId would have changed in the part of the route affected by rerouting, the function must be called once for each individual tripId involved.</li>
</ul>
<h1 id="visualization">Visualization<a class="headerlink" href="#visualization" title="Permanent link">&para;</a></h1>
<h2 id="trains">Trains<a class="headerlink" href="#trains" title="Permanent link">&para;</a></h2>
<p>The length of railway carriages, locomotive and the gap between the
carriages can be configured using the following <a href="../GenericParameters/">generic vType
parameters</a>:</p>
<ul>
<li>locomotiveLength</li>
<li>carriageLength</li>
<li>carriageGap</li>
<li>carriageImages</li>
</ul>
<p>These parameters control the appearance of trains in <a href="../../sumo-gui/">sumo-gui</a> when drawing vehicles with the style 'simple shapes'.
By default, the front of the train will be indicated by a darker carriage color and a front windscreen. This can be disabled by setting <code>locomotiveLength="0"</code>.
The parameter <code>carriageImages</code> accepts a comma-separated list of image file names to enable distinct images when using vehicle style 'raster images'.</p>
<h2 id="network">Network<a class="headerlink" href="#network" title="Permanent link">&para;</a></h2>
<p>By default, railway tracks are shown in <a href="../../sumo-gui/">sumo-gui</a> in a distinct style:</p>
<ul>
<li>tracks and crossties are rendered instead of filled shapes when zoomed in (configurable with visualization setting <em>show rails</em>)</li>
<li>turning arrows are not shown</li>
<li>the <a href="../../sumo-gui/#right_of_way">white bar that indicates right of way</a> is not drawn</li>
<li>junction shapes are not shown and the internal edges that make up a railway switch are always visible (can be changed setting junction coloring to any scheme other than <em>uniform</em>)</li>
<li>traffic light (rail signal) indicators are drawn with an offset to the right to indicate the direction in which the signal is applied</li>
<li>for each pair of edges that make up a bidirectional track, only of is drawn to avoid artifacts. To make both edges visible (i.e. for selecting or otherwise interacting with that edge), the visualization setting <em>spread bidirectional railways/roads</em> in the <em>Streets</em> tab can be activated</li>
<li>the pre-defined gui setting scheme <em>"Rail"</em> can be used to activate the following settings that are helpful for diagnosing a railway simulation</li>
<li><em>spread bidirectional railways/roads</em></li>
<li>coloring junctions <em>by type</em> (making rail signals more visible)</li>
<li>constant junction size (making rail signals bigger when zoomed out)</li>
<li>show lane direction (direction is otherwise hard to judge for uni-directional tracks)</li>
<li>vehicles are shown as <em>simple shapes</em> to ensure articulated train shapes follow curves</li>
</ul>
<h2 id="signaling">Signaling<a class="headerlink" href="#signaling" title="Permanent link">&para;</a></h2>
<p>Rail signal states are shown in sumo-gui as red or green colored bars which are offset towards the righthand side of the track in driving direction. The offset thus indicates the direction of movement to which the signal applies.</p>
<p>The following Objects provide extra information in their context menu to help understand signal switching:</p>
<ul>
<li>rail_signal / tlLogic (accessible by right-clicking on the red/green bar)</li>
<li><strong>req driveway</strong>: The driveWay request by the closest approaching vehicle</li>
<li><strong>blocking</strong>: The list of foe vehicles which are blocking the requested driveway</li>
<li><strong>blocking driveways</strong>: The list of foe driveways which are blocking the requested driveway</li>
<li><strong>rival</strong>: The list of potential foe vehicles that are approaching a foe driveway</li>
<li><strong>priority</strong>: The list of foe vehicles that are approaching a foe driveway and have received priority over the vehicle that approaches the requested driveway</li>
<li><strong>constraint</strong>: A description of the <a href="#schedule_constraints">railSignalConstraint</a> which applies to the closest approaching vehicle and causes this signal to show red</li>
<li>vehicle</li>
<li><strong>driveways</strong>: The list of driveways which this vehicle currently occupies</li>
<li>lane</li>
<li><strong>param:insertionBlocked:VEHICLE_ID</strong>: The driveway requested by VEHICLE_ID on which insertion is currently blocked</li>
<li><strong>blocking DRIVEWAY_ID</strong>: The list of foe vehicles which are blocking the insertion driveway with DRIVEWAY_ID</li>
<li><strong>driveWays blocking DRIVEWAY_ID</strong>: the list of foe driveways which are blocking the requested driveway with DRIVEWAY_ID</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Street coloring mode <a href="../../sumo-gui/#edgelane_visualisation_settings"><em>by insertion backlog</em></a> helps to identify the tracks on which insertion is currently blocked.</p>
</div>
<h2 id="abstract-networks">Abstract Networks<a class="headerlink" href="#abstract-networks" title="Permanent link">&para;</a></h2>
<p>Road networks are most often modelled according to their actual layout in <a href="../../Geo-Coordinates/">cartesian space</a>. Such networks have all distances and angles in the same proportions as those of geographical map.</p>
<p>In the railway domain it is often useful to work with schematic (also called abstract) networks instead of (or in addition to) geographical networks.
Such abstract networks can make it easier so see all tracks and switches on a single screen without zooming and panning. SUMO supports working with abstract maps in the following ways:</p>
<ul>
<li>all roads and tracks can have a custom "length" value that differs from their visual length. This allows to separate the visualization of the network from its simulation behavior (w.r.t. distance traveled).</li>
<li>sumo-gui supports loading an abstract map of a network along with a geographical map by using options <strong>-n geo.net.xml -N abstract.net.xml</strong>. The two networks must have the exact same topology and may only differ in their geometry.</li>
<li>The user may switch between the visualization of either geometry via the hotkey <kbd>Ctrl</kbd> + <kbd>K</kbd> or by setting Street visualization setting <em>secondary shape</em>.</li>
<li>All outputs that include geometry information (i.e. <a href="../Output/FCDOutput/">fcd-output</a>) will be according to the network loaded with option <strong>-n</strong></li>
<li>the tool <a href="../../Tools/Net/#abstractrailpy">abstractRail.py</a> can be used to convert geographic rail networks in abstract rail networks</li>
</ul>
<h1 id="outputs">Outputs<a class="headerlink" href="#outputs" title="Permanent link">&para;</a></h1>
<p>Rail simulation provides optional outputs related to driveways (Fahrstraßen)</p>
<h2 id="railsignal-block-output">railsignal-block-output<a class="headerlink" href="#railsignal-block-output" title="Permanent link">&para;</a></h2>
<p>By setting option <strong>--railsignal-block-output FILE</strong>, an output file that contains informations for every drivway / signaling block is written.</p>
<table>
<thead>
<tr>
<th>Element / Attribute Name</th>
<th>Value Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>driveway / <strong>id</strong></td>
<td>id (string)</td>
<td>The if of the driveWay. See below for interpretation</td>
</tr>
<tr>
<td>driveway/ vehicle</td>
<td>id</td>
<td>The id of the first train that used this driveWay</td>
</tr>
<tr>
<td>driveway / edges</td>
<td>list of edgeIDs</td>
<td>The complete route of the vehicle that first used this drivway</td>
</tr>
<tr>
<td>forward / lanes</td>
<td>list of laneIDs</td>
<td>The list of lanes up to the next signal or the network border</td>
</tr>
<tr>
<td>bidi / lanes</td>
<td>list of laneIDs</td>
<td>The list of oncoming lanes that are in conflict with this driveway</td>
</tr>
<tr>
<td>flank / lanes</td>
<td>list of laneIDs</td>
<td>The list of flanking lanes that are in conflict with this driveway</td>
</tr>
<tr>
<td>conflictLinks / signals</td>
<td>list of strings</td>
<td>The list of short signal link names (<RAILSIGNAL_ID>_<LINK_INDEX>) that are in conflict with this driveway</td>
</tr>
<tr>
<td>foes / driveways</td>
<td>list of driveWay ids</td>
<td>The list of foes driveways. A train may not enter a driveway if any of it's foe driveways is occupied (unless a <code>&lt;siding&gt;</code> definition exists for that foe and the siding is currently usable).</td>
</tr>
<tr>
<td>sidings / foe</td>
<td>driveWay id</td>
<td>The foe driveWay to which the following list of <code>&lt;siding&gt;</code> elements applies</td>
</tr>
<tr>
<td>siding / start</td>
<td>edgeID</td>
<td>The edge on which that siding starts</td>
</tr>
<tr>
<td>siding / end</td>
<td>edgeID</td>
<td>The edge on which that siding ends</td>
</tr>
<tr>
<td>siding / length</td>
<td>float</td>
<td>The length of the siding in meters (a Train may not use a siding if it is shorter than it's own length)</td>
</tr>
<tr>
<td>deadlock / foes</td>
<td>list of driveWay ids</td>
<td>The list of foe driveways that could create a deadlock toghether with the current driveway. If all foes are occupied, the current driveway must not be entered (only present when <a href="#deadlock_prevention"><code>&lt;deadlock&gt;</code> elements</a> where loaded into the simulation</td>
</tr>
</tbody>
</table>
<h3 id="driveway-ids">Driveway IDs<a class="headerlink" href="#driveway-ids" title="Permanent link">&para;</a></h3>
<ul>
<li>normal driveway: <code>&lt;RAIL_SIGNAL_ID&gt;.&lt;INDEX&gt;</code></li>
<li>depart driveway: <code>&lt;JUNCTION_ID&gt;.d&lt;INDEX&gt;</code></li>
<li>subDriveway (Teilfahrstraße): <code>&lt;DRIVEWAY_ID&gt;.&lt;INDEX&gt;</code></li>
</ul>
<h2 id="railsignal-vehicle-output">railsignal-vehicle-output<a class="headerlink" href="#railsignal-vehicle-output" title="Permanent link">&para;</a></h2>
<p>By setting option <strong>--railsignal-vehicle-output FILE</strong>, an output file that contains occupancy informations for every driveway is written.
This file provides the times whenever a vehicle has entered or left a driveway.</p>
<table>
<thead>
<tr>
<th>Element / Attribute Name</th>
<th>Value Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>driveWay / <strong>id</strong></td>
<td>id (string)</td>
<td>The driveWay to which the following <code>&lt;entry&gt;</code> and <code>&lt;exit&gt;</code> elements apply</td>
</tr>
<tr>
<td>subDriveWay / <strong>id</strong></td>
<td>id (string)</td>
<td>The driveWay to which the following <code>&lt;entry&gt;</code> and <code>&lt;exit&gt;</code> elements apply</td>
</tr>
<tr>
<td>entry / <strong>id</strong></td>
<td>id (string)</td>
<td>The id of the vehicle that entered the driveway</td>
</tr>
<tr>
<td>entry / time</td>
<td>float or HH:MM:SS</td>
<td>The time at which the vehicle entered the driveWay</td>
</tr>
<tr>
<td>entry / reason</td>
<td>string</td>
<td>The reason for entering the driveWay</td>
</tr>
<tr>
<td>exit / <strong>id</strong></td>
<td>id (string)</td>
<td>The id of the vehicle that left the driveway</td>
</tr>
<tr>
<td>exit / time</td>
<td>float or HH:MM:SS</td>
<td>The time at which the vehicle left the driveWay</td>
</tr>
<tr>
<td>exit / reason</td>
<td>string</td>
<td>The reason for leaving the driveWay</td>
</tr>
</tbody>
</table>
<h1 id="miscellaneous">Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permanent link">&para;</a></h1>
<ul>
<li>Error checking for <a href="../Public_Transport/#single_vehicles_and_trips">railway schedules</a> can be done with the tool <a href="../../Tools/Routes/#checkstoporderpy">checkStopOrder.py</a></li>
<li>The tool <a href="../../Tools/Railways/#schedulestatspy">scheduleStats.py</a> can be used to check how closely simulated train behavior conforms to a loaded rail schedule w.r.t. punctuality and expected traveltimes between stops.</li>
</ul>
<h1 id="limitations">Limitations<a class="headerlink" href="#limitations" title="Permanent link">&para;</a></h1>
<ul>
<li>Individual rail cars / coupling / uncoupling cannot currently be modeled</li>
<li>Distant signals (Vorsignale) are not modelled. Instead trains act as if always having full visibility onto the next main signal</li>
<li>Delay of railroad switches is not modelled</li>
<li>Overlap (Durchrutschweg) after a rail signal (which guarantuess safety if a red signal is violated), is currently not modelled by the rail signal safety assessment</li>
<li>Axle counters are assumed after every signal and every railway switch and correspondingly, partial driveways (Teilfahrstraßen) are used in the most efficient manner</li>
<li>Stretching and shorting of long trains is not modelled</li>
<li>Operational restrictings on reversing trains (Shunting) are not modelled. Trains may reverse according to their defined route and move at normal speeds / acceleration in either direction (subject to rail signal safety rules).</li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>