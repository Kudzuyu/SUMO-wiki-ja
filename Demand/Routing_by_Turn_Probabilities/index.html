
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://kudzuyu.github.io/SUMO-wiki-ja/Demand/Routing_by_Turn_Probabilities/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Routing by Turn Probabilities - SUMO wiki ja</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansjp.css">
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:600,800">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#turn-definitions" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../.." title="SUMO wiki ja" class="md-header__button md-logo" aria-label="SUMO wiki ja" data-md-component="logo">
      
  <img src="../../images/sumo-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SUMO wiki ja
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Routing by Turn Probabilities
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="タブ" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  ドキュメント

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../Downloads/" class="md-tabs__link">
        
  
  
    
  
  ダウンロード

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../Publications/" class="md-tabs__link">
        
  
  
    
  
  出版物

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SUMO wiki ja" class="md-nav__button md-logo" aria-label="SUMO wiki ja" data-md-component="logo">
      
  <img src="../../images/sumo-logo.png" alt="logo">

    </a>
    SUMO wiki ja
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ドキュメント
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Downloads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ダウンロード
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Publications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    出版物
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#turn-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Turn Definitions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Turn Definitions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-generation-of-turn-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic generation of turn definitions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sinks-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Sinks Definitions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Flow Definitions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flow Definitions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#random-flows" class="md-nav__link">
    <span class="md-ellipsis">
      Random Flows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overlapping-flows" class="md-nav__link">
    <span class="md-ellipsis">
      Overlapping Flows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-options" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Options
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Routing by Turn Probabilities</h1>

<p>The <a href="../../jtrrouter/">jtrrouter</a> is a routing applications which
uses flows and turning percentages at junctions as input. The following
parameter must be supplied:</p>
<ul>
<li>the network to route the vehicles through,</li>
<li>the description of the turning ratios for the junctions (defaults
   may be used for this, too), and</li>
<li>the descriptions of the flows.</li>
</ul>
<p>A call may look like this:</p>
<pre><code>jtrrouter --route-files=&lt;FLOW_DEFS&gt; --turn-ratio-files=&lt;TURN_DEFINITIONS&gt; --net-file=&lt;SUMO_NET&gt; \
  --output-file=MySUMORoutes.rou.xml --begin &lt;UINT&gt; --end &lt;UINT&gt;
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When turn-counts instead of turn-ratios are available, <a href="../Routes_from_Observation_Points/">other tools may be used</a>.</p>
</div>
<h2 id="turn-definitions">Turn Definitions<a class="headerlink" href="#turn-definitions" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Turn and Sink Definitions</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Filename extension</td>
<td>.turns.xml</td>
</tr>
<tr>
<td>Type of content</td>
<td>turn and sink definitions</td>
</tr>
<tr>
<td>Open format?</td>
<td>Yes</td>
</tr>
<tr>
<td>SUMO specific?</td>
<td>Yes</td>
</tr>
<tr>
<td>XML Schema</td>
<td><a href="https://sumo.dlr.de/xsd/edgerelations_file.xsd">edgerelations_file.xsd</a></td>
</tr>
</tbody>
</table>
<p>To describe the turn definitions, one has to write an XML file. Within
this file, for each interval and each edge the list of percentages to
use a certain follower edge has to be given. An example:</p>
<pre><code class="language-xml">&lt;edgeRelations&gt;
   &lt;interval begin=&quot;0&quot; end=&quot;3600&quot;&gt;
      &lt;edgeRelation from=&quot;myEdge0&quot; to=&quot;myEdge1&quot; probability=&quot;0.2&quot;/&gt;
      &lt;edgeRelation from=&quot;myEdge0&quot; to=&quot;myEdge2&quot; probability=&quot;0.7&quot;/&gt;
      &lt;edgeRelation from=&quot;myEdge0&quot; to=&quot;myEdge3&quot; probability=&quot;0.1&quot;/&gt;

      ... any other edges ...

   &lt;/interval&gt;

   ... some further intervals ...

&lt;/edgeRelations&gt;
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you provide turn definitions that overlap (for example in multiple files), the latter turn definition will override the former.</p>
</div>
<p>The snippet defines that vehicles coming at the end of edge
"<code>myEdge0</code>" within the time interval between
0s and 3600s will choose the edge "<code>myEdge1</code>"
with a probability of 20%, "<code>myEdge2</code>" with a
probability of 70% and "<code>myEdge3</code>" with a
probability of 10%. Another possibility to save time on preparing the
description is to use default values. The parameter <strong>--turn-defaults (-T) &lt;TURN_DEFAULTS&gt;</strong> can be used to
describe the default ratios that will be used for all junctions for all
time steps. &lt;TURN_DEFAULTS&gt; is a list of doubles, separated by a ','. To
achieve the same behavior as in the example above, use <strong>--turn-defaults 20,70,10</strong>. The values
will be applied to an edge's following edges beginning at the right edge
(20%) and ending at the leftmost edge (10%). As the number of possible
followers changes for different edges, the values are resampled for
edges which number of following edges differs from the number of given
turning probability defaults. Given <strong>--turn-defaults 20,70,10</strong> a vehicle using an edge that has
two followers would use the follower to the right with 55% probability,
the one to the left with 45%.</p>
<h3 id="automatic-generation-of-turn-definitions">Automatic generation of turn definitions<a class="headerlink" href="#automatic-generation-of-turn-definitions" title="Permanent link">&para;</a></h3>
<p>For automatic, yet artificial, turn definitions generation based on the
network structure, see <a href="../../Tools/Turns/#generateturndefspy">generateTurnDefs.py</a>.</p>
<p>You can also generate turn definitions from an existing route file. see <a href="../../Tools/Turns/#generateturnratiospy">generateTurnRatios.py</a>.</p>
<h2 id="sinks-definitions">Sinks Definitions<a class="headerlink" href="#sinks-definitions" title="Permanent link">&para;</a></h2>
<p>A vehicle leaves the network as soon as it comes to a sink edge. As not
all networks have sink edges defined, one can support a list of edges to
be declared as sinks using <strong>--sinks &lt;EDGE_ID&gt;[,&lt;EDGE_ID&gt;]</strong>*. You may also add your sink definitions to a
turn-file (XML only):</p>
<pre><code class="language-xml">&lt;turns&gt;
   ... some further turning definitions as above ...

   &lt;sink edges=&quot;&lt;EDGE_ID&gt;[ &lt;EDGE_ID&gt;]*&quot;/&gt;
   ... further sink definitions ...

&lt;/turns&gt;
</code></pre>
<p>If you do not define sinks, the option <strong>--accept-all-destinations</strong> <a href="/Basics/Notation/#データタイプ"><em>&lt;BOOL&gt;</em></a> may be used to declare all edge
as possible sinks.</p>
<h2 id="flow-definitions">Flow Definitions<a class="headerlink" href="#flow-definitions" title="Permanent link">&para;</a></h2>
<p>The <a href="../../Definition_of_Vehicles%2C_Vehicle_Types%2C_and_Routes/#repeated_vehicles_flows">definitions of the
flow</a>
is the same as for the <a href="../../duarouter/">duarouter</a> with just a
single difference: as it is not known where the vehicle will leave the
network as the route it uses is randomly computed, the route must be
specified using attribute <em>from</em> and attribute <em>to</em> must be omitted:</p>
<pre><code class="language-xml">&lt;routes&gt;
   &lt;flow id=&quot;example0&quot; from=&quot;A&quot; begin=&quot;0&quot; end=&quot;3600&quot; probability=&quot;0.5&quot;/&gt;
   &lt;flow id=&quot;example1&quot; ... /&gt;
   ....
&lt;/routes&gt;
</code></pre>
<h3 id="random-flows">Random Flows<a class="headerlink" href="#random-flows" title="Permanent link">&para;</a></h3>
<p>The tool <a href="../../Tools/Trip/#randomtripspy">randomTrips.py</a> can be
used to generated jtrrouter input by setting options <strong>--flows</strong> <a href="/Basics/Notation/#データタイプ"><em>&lt;INT&gt;</em></a> <strong>--jtrrouter</strong>.</p>
<h2 id="overlapping-flows">Overlapping Flows<a class="headerlink" href="#overlapping-flows" title="Permanent link">&para;</a></h2>
<p>By default JTRRouter will route flows through the network and split them at intersections until each part of the flow has reached a sink edge. When such a flow reaches the source edge of another flow, the total traffic is added.
The following options can change this behavior:</p>
<ul>
<li><strong>--sources-are-sinks</strong> (shortcut <strong>-S</strong>). When this option is set, all flows will terminate upon reaching the from-edge of another flow. Issue #6601</li>
<li><strong>--discount-sources</strong> (shortcut <strong>-D</strong>). When this option is set, the flow departing at an edge will be reduced by the amount of traffic that has reached this edge from upstream flows. When combined with option <strong>--sources-are-sinks</strong>, upstream flows will terminate at a downstream edge when the source flow number has been reached.</li>
</ul>
<h2 id="additional-options">Additional Options<a class="headerlink" href="#additional-options" title="Permanent link">&para;</a></h2>
<p>As theoretically a route may get infinitely long when a vehicle is
forced to take always the same direction, it is possible to limit the
route's size using option <strong>--max-edges-factor</strong> <a href="/Basics/Notation/#データタイプ"><em>&lt;FLOAT&gt;</em></a>. This factor, multiplied with the number of
the used network's edges is the maximum number of edges a route may
have. With the default of 2.0, a route may contain twice as many edges
as the network has. Any route longer than this size will be marked as
invalid. We assume that for each network this number has to be chosen
again.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>