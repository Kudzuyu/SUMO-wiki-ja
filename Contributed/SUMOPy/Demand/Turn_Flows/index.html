
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://kudzuyu.github.io/SUMO-wiki-ja/Contributed/SUMOPy/Demand/Turn_Flows/">
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Turn Flows - SUMO wiki ja</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../css/extra.css">
    
      <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansjp.css">
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:600,800">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../../../.." title="SUMO wiki ja" class="md-header__button md-logo" aria-label="SUMO wiki ja" data-md-component="logo">
      
  <img src="../../../../images/sumo-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SUMO wiki ja
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Turn Flows
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="タブ" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  ドキュメント

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../Downloads/" class="md-tabs__link">
        
  
  
    
  
  ダウンロード

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../Publications/" class="md-tabs__link">
        
  
  
    
  
  出版物

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="SUMO wiki ja" class="md-nav__button md-logo" aria-label="SUMO wiki ja" data-md-component="logo">
      
  <img src="../../../../images/sumo-logo.png" alt="logo">

    </a>
    SUMO wiki ja
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ドキュメント
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Downloads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ダウンロード
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Publications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    出版物
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Turn Flows</h1>

<p>Trip generation with turnflows allows to model traffic flows in a
precise way, for simple, possibly loop-free networks with few internal
traffic generation. The general idea is to generate trips and routes for
individual vehicles based on road traffic counts. These traffic counts
can be performed at junctions. Ideally, the traffic counts should be
performed simultaneously at all relevant junctions. However, some edge
flows can be derived from other edge flows considering flow preservation
lows at nodes.</p>
<p>Basically two types of flows are needed in order to reconstruct the
routes in a predefined study area:</p>
<ul>
<li>The <em>generating flows</em> <span><em>FG[a]</em></span> on all edges
  <span><em>a</em></span> that <em>enter</em> the study area. [1]</li>
<li>The <em>turn flows</em> <span><em>FT[a1,a2]</em></span> for all flows between
  links <span><em>a1</em></span> and <span><em>a2</em></span> at nodes with more
  than one exiting edge.</li>
</ul>
<p>The choice of traffic flows that need to be counted is illustrated by an
example network:</p>
<p><img alt="Figure_demand_turnsflows.png" src="../../../../images/Figure_demand_turnsflows.png" title="Example network to illustrate the use of turnflows for demand modeling." /></p>
<p>Neglecting all traffic generated within the study area, the following
flows need to be counted:</p>
<ul>
<li>The <em>generating flows</em> <em>FG[3], FG[12]</em> are
  entering the network.</li>
<li>The <em>turn flows</em> <em>F[8,9], F[8,2]</em> at node <em>6</em> and <em>F[12,4], F[12,7]</em> at node <em>3</em>. All other nodes have only one exiting edge.</li>
</ul>
<p>Once the necessary flows are counted for all considered transport modes
and time intervals, the trips and routes of all vehicles can be
generated with a special router, called JTRouter.</p>
<p>With SUMOPY the route generation with SUMOPY works as follows: First
import flows and turnflows from a CSV file by selecting the menu item</p>
<p><code>Demand&gt;Turnflows&gt;Import turnflows</code></p>
<p>The import turnflows dialog will pop up, as shown below.</p>
<p><img alt="fig_sumopy_gui_turnflowwizard.png" src="../../../../images/Fig_sumopy_gui_turnflowwizard.png" title="Dialog for importing turnflow CSV files" /></p>
<p>This dialog is similar to the OD-flow wizard explained in Sec. <a href="../Zone_To_Zone/">Zone
to zone demand flows</a> and allows
to import traffic counts, and associate them with a time interval and a
transport mode.</p>
<p>The <code>Turnflow File</code> to be imported contains the traffic counts of both
flow types, generating flows and turnflows. The turnflow file has the
following format:</p>
<pre><code>&lt;ID1&gt;, &lt;count 1&gt;, &lt;ID11&gt;, &lt;count 11&gt;,  &lt;ID12&gt;, &lt;count 12&gt;, ...
&lt;ID2&gt;, &lt;count 2&gt;, &lt;ID21&gt;, &lt;count 21&gt;,  &lt;ID22&gt;, &lt;count 22&gt;, ...
...
</code></pre>
<p>This notation has the following meaning:</p>
<p><code>&lt;IDa&gt;</code> means the SUMO edge ID of edge <em>a</em>, where edge
<em>a</em> is the edge entering a node.</p>
<p><code>&lt;IDab&gt;</code> means the SUMO edge ID of edge <em>ab</em>, where edge
<em>ab</em> is the edge outgoing from the node which edge
<em>a</em> enters.</p>
<p><code>&lt;count a&gt;</code> means the number of vehicles leaving edge <em>a</em>, in
case the edge is generating flows, otherwise this count is zero.</p>
<p><code>&lt;count ab&gt;</code> means the number of vehicles from edge <em>a</em>
turning into edge <em>b</em>.</p>
<p>All counts in this file refer to the mode and time interval specified in
the dialog box.</p>
<p>The turnflow file for the example network shown
<a href="../../../../images/Figure_demand_turnsflows.png">above</a>, could look like
this:</p>
<pre><code>3, 1000
12, 800, 4, 200, 7, 600
8, 0, 9, 800, 2, 400
</code></pre>
<p>In this case, the generating flows <em>FG[3]=1000, F[12]=800</em> and the turn flows <em>FT[8,9] = 800, FT[8,2] = 400</em> and <em>FT[12,4] = 200, FT[12,7] = 500</em> for a
specific mode and time interval.</p>
<p><em>Hint:</em> In order to quickly compile the turnflow file, open a text
editor and the SUMOPy window next to each other. In the SUMOPy network
editor, deselect lanes, connections and crossings by clicking on the
button next to the zoom buttons below the network canvas. Then select
the info tool (if not already active) and click on the edges you
consider for the turnflow file. The respective edge will be highlighted
and you can see all edge attributes in the object browser, as shown
below:</p>
<p><img alt="fig_sumopy_gui_edgeid.png" src="../../../../images/Fig_sumopy_gui_edgeid.png" title="Fig sumopy gui edgeid.png" /></p>
<p>From there, copy the SUMO edge ID and paste it into your turnflow text
file.</p>
<p>Optionally define destination zones: Within the turnflow demand model
destination zones define edges where vehicle routes end. This may be
necessary in order to prevent vehicles of making a loop on the network
outside the study area and re-entering the study area. Destination zones
for turnflows are created in the same way as Traffic assignment Zones in
section <a href="../Zone_To_Zone/">Zone
to zone demand flows</a>.</p>
<p>Generate directly route from flows and turn-flows information by
selecting menu item</p>
<p><code>Demand&gt;Turnflows&gt;Turnflows to routes</code></p>
<p>This process is using SUMO’s jtrrouter and will generate both trips and
routes. The scenario is now ready to be simulated by selecting</p>
<p><code>Simulation&gt;Sumo&gt;export routes and simulate...</code></p>
<p>A test file for turnflows is located in</p>
<p><code>SUMOHOME/tools/contributed/sumopy/testscenario/demo_dem_tf_car.csv</code></p>
<ol>
<li>In addition, traffic flows can also be generated on edges within the
    study area, but in practice it is difficult to measure those flows
    because one would need to spot and count only departing vehicles
    along the roads of the study area. However, for some particular
    edges with many departing vehicles this may be necessary to do.</li>
</ol>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>